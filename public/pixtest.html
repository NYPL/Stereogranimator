<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>pixastic test</title>

<link href="/css/style.css" rel="stylesheet" type="text/css" />

<script src="/assets/jquery.js?body=1" type="text/javascript"></script>
<script src="/js/src/easeljs/utils/UID.js"></script>
<script src="/js/src/easeljs/geom/Matrix2D.js"></script>
<script src="/js/src/easeljs/events/MouseEvent.js"></script>
<script src="/js/src/easeljs/display/DisplayObject.js"></script>
<script src="/js/src/easeljs/display/Container.js"></script>
<script src="/js/src/easeljs/display/Bitmap.js"></script>
<script src="/js/src/easeljs/display/Stage.js"></script>
<script src="/js/jquery.getimagedata.min.js"></script>
<script src="/js/pixastic.custom.js"></script>

<script>
var canvas;
var stage;
var leftbmp;
var rightbmp;

var leftimg = new Image();
var rightimg = new Image();

var leftimgdata;
var rightimgdata;

function init() {
	//find canvas and load images, wait for last image to load
	canvas = document.getElementById("testCanvas");
	
	stage = new Stage(canvas);
	
	console.log("photo");
	
	$.getImageData({
	  url: "http://images.nypl.org/index.php?id=1531158&t=w",
	  success: function(image){
	    // Do something with the now local version of the image
		// Set up the canvas
	    var ctx = canvas.getContext('2d');
	 
	    // Set the canvas width and heigh to the same as the image
	    $(canvas).attr('width', image.width);
	    $(canvas).attr('height', image.height);
	 
	    // Draw the image on to the canvas
	    ctx.drawImage(image, 0, 0, image.width, image.height);
	 
	    // Get the image data
	    var image_data = ctx.getImageData(0, 0,  image.width, image.height);
	    var image_data_array = image_data.data;
	 
	    // Invert every pixel
	    for (var i = 0, j = image_data_array.length; i < j; i+=4) {
	      image_data_array[i] = 255 - image_data_array[i];
	      image_data_array[i+1] = 255 - image_data_array[i+1];
	      image_data_array[i+2] = 255 - image_data_array[i+2];
	    }
	 
	    // Write the image data to the canvas
	    ctx.putImageData(image_data, 0, 0);

	  },
	  error: function(xhr, text_status){
	    // Handle your error here
	    console.log("Could not load left image");
	  }
	});
/*
	leftimg.onload = (function () {
		// place image
		leftbmp = new Bitmap(leftimg);
		stage.addChild(leftbmp);
		leftimgdata = canvas.getContext("2d").getImageData(0, 0, leftbmp.width, leftbmp.height);
		
		rightimg.onload = (function () {
			rightbmp = new Bitmap(rightimg);
			stage.addChild(rightbmp);
			rightimgdata = canvas.getContext("2d").getImageData(0, 0, rightbmp.width, rightbmp.height);
			Pixastic.process(leftbmp,"blend", {
				amount: 1,
				mode: "multiply",
				image: rightbmp
			});
		});
		rightimg.src = "http://images.nypl.org/index.php?id=G92F111_051ZF&t=w";
		
		stage.update();
	});
	leftimg.src = "http://images.nypl.org/index.php?id=1531158&t=w";
*/
}

window.onload = init;

</script>
</head>
	
<body>
	<div class="description">
		<p>
			3D Anaglyph test.
		</p>
	</div>
	<div class="canvasHolder">
		<canvas id="testCanvas" width="900" height="600"></canvas>
	</div>
</body>
</html>
